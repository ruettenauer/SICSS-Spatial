---
title: "Part 1: Using and linking spatial data"
author: "Tobias RÃ¼ttenauer"
date: "June 19, 2021"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 2
theme: united
bibliography: sicss-spatial.bib
link-citations: yes
---

### Required packages

```{r}
pkgs <- c("sf", "mapview")
lapply(pkgs, require, character.only = TRUE)
```

### Session info

```{r}
sessionInfo()
```

### Coordinates

In general, spatial data is structured like conventional data (e.g. data.frames, matrices), but add one additional dimension: every observation is linked to some type geo-spatial information. Most common types of spatial information are:

* Points (one coordinate pair)

* Lines (two coordinate pairs)

* Polygons (at least three coordinate pairs)

* Raster (one coordinate pair for centroid + raster / grid size)


### Coordinate reference system (CRS)

In its raw form, a pair of coordinates consists of two numerical values. For instance, the pair `c(51.753135871732624, -1.2617541317766832)` describes the location of Nuffield College in Oxford (one point). The fist number gives us the latitude (north-south direction), the second number gives us the longitude (west-east direction), both in decimal degrees.

![Figure: Latitude and longitude, Source: [Wikipedia](https://en.wikipedia.org/wiki/Geographic_coordinate_system)](fig/lat-long.png)

However, we need to specify a reference point for latitudes and longitudes (in the Figure above: equator and Greenwich). For instance, the pair of coordinates above comes from the Google Maps, which returns GPS coordinates in 'WGS 84' ([EPSG:4326](https://epsg.io/4326)). 

#### Projected CRS

However, different data providers use different CRS. For instance, spatial data in the UK usually uses 'OSGB 1936 / British National Grid' ([EPSG:27700](https://epsg.io/27700)). Here, coordinates are in meters, and projected onto a planar 2D space. Generally, every provider of spatial data should specify which reference system they use, as using the correct reference system and projection is important for plotting and transforming spatial data, as well as for measuring distances. If you do not know the correct CRS, try starting with some standards, like [EPSG:4326](https://epsg.io/4326) in case you have decimal degree like coordinates, or try searching for the source in CRS libraries, like https://epsg.io/. However, you must check if the projected coordinates match their real location, e.g. using `mpaview()`.

```{r}
library(sf)
library(mapview)

# Coordinate paris of two locations
coords1 <- c(51.752595, -1.262801)
coords2 <- c(51.753237, -1.253904)
coords <- rbind(coords1, coords2)

# Conventional data frame
nuffield.df <- data.frame(name = c("Nuffield College", "Radcliffe Camera"),
                          address = c("New Road", "Radcliffe Sq"),
                          lat = coords[,1], lon = coords[,2])

head(nuffield.df)

# Combine to spatial data frame
nuffield.spdf <- st_as_sf(nuffield.df, coords = c("lon", "lat"), 
                          crs = 4326) # EPSG number of CRS

# Map
mapview(nuffield.spdf, zcol = "name")
```

#### Why do we need different reference systems?




### Spatial data manipulation

https://cran.r-project.org/web/packages/sf/vignettes/sf3.html

https://cran.r-project.org/web/packages/sf/vignettes/sf4.html

