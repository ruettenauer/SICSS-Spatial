<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Tobias Rüttenauer" />

<meta name="date" content="2021-06-19" />

<title>Part 2: Analysing spatial data</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SICSS Oxford - Spatial</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="SICSS-spatial_part1.html">Part 1: Using and linking spatial data</a>
</li>
<li>
  <a href="SICSS-spatial_part2.html">Part 2: Analysing spatial data</a>
</li>
<li>
  <a href="SICSS-spatial_part3.html">Practical exercises</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Part 2: Analysing spatial data</h1>
<h4 class="author">Tobias Rüttenauer</h4>
<h4 class="date">June 19, 2021</h4>

</div>


<div id="required-packages" class="section level3">
<h3>Required packages</h3>
<pre class="r"><code>pkgs &lt;- c(&quot;sf&quot;, &quot;mapview&quot;, &quot;spdep&quot;, &quot;spatialreg&quot;, &quot;tmap&quot;, &quot;viridisLite&quot;) # note: load spdep first, then spatialreg
lapply(pkgs, require, character.only = TRUE)</code></pre>
</div>
<div id="session-info" class="section level3">
<h3>Session info</h3>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19042)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United Kingdom.1252 
## [2] LC_CTYPE=English_United Kingdom.1252   
## [3] LC_MONETARY=English_United Kingdom.1252
## [4] LC_NUMERIC=C                           
## [5] LC_TIME=English_United Kingdom.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] viridisLite_0.4.0   tmap_3.3-1          spatialreg_1.1-8   
##  [4] Matrix_1.3-3        spdep_1.1-8         spData_0.3.8       
##  [7] sp_1.4-5            dplyr_1.0.6         rnaturalearth_0.1.0
## [10] nngeo_0.4.3         mapview_2.10.0      sf_1.0-0           
## 
## loaded via a namespace (and not attached):
##  [1] sass_0.4.0              jsonlite_1.7.2          splines_4.1.0          
##  [4] gtools_3.9.2            bslib_0.2.5.1           expm_0.999-6           
##  [7] highr_0.9               stats4_4.1.0            yaml_2.2.1             
## [10] LearnBayes_2.15.1       pillar_1.6.1            lattice_0.20-44        
## [13] glue_1.4.2              uuid_0.1-4              digest_0.6.27          
## [16] RColorBrewer_1.1-2      colorspace_2.0-1        leaflet.providers_1.9.0
## [19] htmltools_0.5.1.1       XML_3.99-0.6            pkgconfig_2.0.3        
## [22] raster_3.4-10           stars_0.5-3             gmodels_2.18.1         
## [25] purrr_0.3.4             scales_1.1.1            webshot_0.5.2          
## [28] gdata_2.18.0            brew_1.0-6              svglite_2.0.0          
## [31] satellite_1.0.2         tibble_3.1.2            proxy_0.4-26           
## [34] generics_0.1.0          farver_2.1.0            ellipsis_0.3.2         
## [37] leafsync_0.1.0          magrittr_2.0.1          crayon_1.4.1           
## [40] deldir_0.2-10           evaluate_0.14           fansi_0.5.0            
## [43] nlme_3.1-152            MASS_7.3-54             lwgeom_0.2-6           
## [46] class_7.3-19            tools_4.1.0             lifecycle_1.0.0        
## [49] stringr_1.4.0           munsell_0.5.0           compiler_4.1.0         
## [52] jquerylib_0.1.4         e1071_1.7-7             systemfonts_1.0.2      
## [55] rlang_0.4.11            tmaptools_3.1-1         classInt_0.4-3         
## [58] units_0.7-2             grid_4.1.0              leafpop_0.1.0          
## [61] dichromat_2.0-0         htmlwidgets_1.5.3       crosstalk_1.1.1        
## [64] leafem_0.1.6            base64enc_0.1-3         rmarkdown_2.8          
## [67] boot_1.3-28             codetools_0.2-18        abind_1.4-5            
## [70] DBI_1.1.1               R6_2.5.0                knitr_1.33             
## [73] rgeos_0.5-5             utf8_1.2.1              KernSmooth_2.23-20     
## [76] stringi_1.6.2           parallel_4.1.0          Rcpp_1.0.6             
## [79] vctrs_0.3.8             png_0.1-7               leaflet_2.0.4.1        
## [82] tidyselect_1.1.1        xfun_0.23               rnaturalearthdata_0.1.0
## [85] coda_0.19-4</code></pre>
</div>
<div id="load-spatial-data" class="section level3">
<h3>Load spatial data</h3>
<p>See previous file.</p>
<pre class="r"><code>load(&quot;msoa_spatial.RData&quot;)</code></pre>
</div>
<div id="spatial-interdependence" class="section level3">
<h3>Spatial interdependence</h3>
<p>We can not only use coordinates and geo-spatial information to connect different data sources, we can also explicitly model spatial (inter)depence in the analysis of our data. In many instance, accounting for spatial dependence might even be necessary to avoid biased point estimates and standard errors. The reason is our observations are often not independent and identically distributed: ‘everything is related to everything else, but near things are more related than distant things’ <span class="citation">(<a href="#ref-Tobler.1970.0" role="doc-biblioref">Tobler 1970</a>)</span>.</p>
<p>However, even if we would receive unbiased estimates with conventional methods, using the spatial information inherent in the data can help us detect specific patterns and spatial relations.</p>
</div>
<div id="boldsymbolmathbfw-connectivity-between-units" class="section level3">
<h3><span class="math inline">\({\boldsymbol{\mathbf{W}}}\)</span>: Connectivity between units</h3>
<p>To analyse spatial relations, we first need to define some sort of connectivity between units (e.g. similar to network analysis). There is an ongoing debate about the importance of spatial weights for spatial econometrics and about the right way to specify weights matrices <span class="citation"><a href="#ref-Neumayer.2016.0" role="doc-biblioref">Neumayer and Plümper</a> (<a href="#ref-Neumayer.2016.0" role="doc-biblioref">2016</a>)</span>. The following graph shows some possible options in how to define connectivity between units.</p>
<div class="figure">
<img src="fig/Bivand_neighbours.png" alt="" />
<p class="caption">Figure: Spatial data linkage, Source: <span class="citation"><a href="#ref-Bivand.2018.748" role="doc-biblioref">Bivand, Pebesma, and Gómez-Rubio</a> (<a href="#ref-Bivand.2018.748" role="doc-biblioref">2008</a>)</span></p>
</div>
<p>In spatial econometrics, the spatial connectivity (as shown above) is usually represented by a spatial weights matrix <span class="math inline">\({\boldsymbol{\mathbf{W}}}\)</span>: <span class="math display">\[
\begin{equation} 
        \boldsymbol{\mathbf{W}} = \begin{bmatrix} 
            w_{11} &amp; w_{12} &amp; \dots &amp; w_{1n} \\
            w_{21} &amp; w_{22} &amp; \dots &amp; w_{2n} \\
            \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
            w_{n1} &amp; w_{n2} &amp; \dots     &amp; w_{nn} 
            \end{bmatrix}
        \end{equation}
\]</span> Note: The diagonal elements <span class="math inline">\(w_{i,i}= w_{1,1}, w_{2,2}, \dots, w_{n,n}\)</span> of <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> are always zero. No unit is a neighbour of itself.</p>
<div id="contiguity-weights" class="section level4">
<h4>Contiguity weights</h4>
<p>A very common type of spatial weights. Binary specification, taking the value 1 for neighbouring units (queens: sharing a common edge; rook: sharing a common border), and 0 otherwise.</p>
<p>Contiguity weights <span class="math inline">\(w_{i,j} =\)</span></p>
<ul>
<li><p>1 if <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> neighbours</p></li>
<li><p>0 </p></li>
</ul>
<p><span class="math display">\[
        \begin{equation} 
        \boldsymbol{\mathbf{W}}  = \begin{bmatrix} 
            0 &amp; 0 &amp; 1  \\
            0 &amp; 0 &amp; 0  \\
            1 &amp; 0 &amp; 0  
            \end{bmatrix}   \nonumber
        \end{equation}
\]</span></p>
<ul>
<li><p>Sparse matrices</p></li>
<li><p>Problem of `island’ (units without neighbours)</p></li>
</ul>
<p>Lets create a contiguity weights matrix (Queens neighbours) for the London MSOAs. Therefore, we create a neighbours list (<code>nb</code>), which is an efficient way of storing <span class="math inline">\({\boldsymbol{\mathbf{W}}}\)</span>.</p>
<pre class="r"><code># Contiguity (Queens) neighbours weights
queens.nb &lt;- poly2nb(msoa.spdf, 
                     queen = TRUE, 
                     snap = 1) # we consider points in 1m distance as &#39;touching&#39;
summary(queens.nb)</code></pre>
<pre><code>## Neighbour list object:
## Number of regions: 983 
## Number of nonzero links: 5620 
## Percentage nonzero weights: 0.5816065 
## Average number of links: 5.717192 
## Link number distribution:
## 
##   2   3   4   5   6   7   8   9  10  11  12  13 
##   9  40 132 268 279 159  63  19   6   5   2   1 
## 9 least connected regions:
## 160 270 475 490 597 729 755 778 861 with 2 links
## 1 most connected region:
## 946 with 13 links</code></pre>
<pre class="r"><code># Lets plot that
plot(st_geometry(msoa.spdf), border = &quot;grey60&quot;)
plot(queens.nb, st_centroid(st_geometry(msoa.spdf)), 
     add = TRUE, pch = 19, cex = 0.6)</code></pre>
<p><img src="SICSS-spatial_part2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code># We can also transform this into the matrix
W &lt;- nb2mat(queens.nb, style = &quot;B&quot;)
print(W[1:10, 1:10])</code></pre>
<pre><code>##    [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
## 1     0    0    0    0    0    0    0    0    0     0
## 2     0    0    1    0    0    0    0    0    0     0
## 3     0    1    0    0    1    0    0    0    0     0
## 4     0    0    0    0    0    1    0    0    0     1
## 5     0    0    1    0    0    1    1    0    0     0
## 6     0    0    0    1    1    0    1    0    1     1
## 7     0    0    0    0    1    1    0    1    1     0
## 8     0    0    0    0    0    0    1    0    0     0
## 9     0    0    0    0    0    1    1    0    0     1
## 10    0    0    0    1    0    1    0    0    1     0</code></pre>
</div>
<div id="distance-based-weights" class="section level4">
<h4>Distance based weights</h4>
<p>Another common type uses the distance <span class="math inline">\(d_{ij}\)</span> between each unit <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<ul>
<li>Inverse distance weights <span class="math inline">\(w_{i,j} = \frac{1}{d_{ij}}\)</span></li>
</ul>
<p><span class="math display">\[
        \begin{equation} 
        \boldsymbol{\mathbf{W}} = \begin{bmatrix} 
            0 &amp; \frac{1}{d_{ij}} &amp; \frac{1}{d_{ij}}  \\
            \frac{1}{d_{ij}} &amp; 0 &amp; \frac{1}{d_{ij}}  \\
            \frac{1}{d_{ij}} &amp; \frac{1}{d_{ij}} &amp; 0  
            \end{bmatrix}   \nonumber
        \end{equation}
\]</span></p>
<ul>
<li><p>Dense matrices</p></li>
<li><p>Specifying thresholds may be useful (to get rid of very small non-zero weights)</p></li>
</ul>
<p>For now, we will just specify a neighbours list with a distance threshold of 3km using <code>dnearneigh()</code>. An alternative would be k nearest neighbours using <code>knearneigh()</code>. We will do the inverse weighting later.</p>
<pre class="r"><code># Crease centroids
coords &lt;- st_geometry(st_centroid(msoa.spdf))</code></pre>
<pre><code>## Warning in st_centroid.sf(msoa.spdf): st_centroid assumes attributes are
## constant over geometries of x</code></pre>
<pre class="r"><code># Neighbours within 5km distance
dist_3.nb &lt;- dnearneigh(coords, d1 = 0, d2 = 3000)
summary(dist_3.nb)</code></pre>
<pre><code>## Neighbour list object:
## Number of regions: 983 
## Number of nonzero links: 22086 
## Percentage nonzero weights: 2.285652 
## Average number of links: 22.46796 
## Link number distribution:
## 
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
##  4  3  7 13 11 14 14 17 26 22 26 30 33 34 46 34 59 43 38 30 25 19 22 15 21 14 
## 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 
## 23 17 17 23 28 19 26 24 29 24 27 25 22 18  8 10 12  5  3  2  1 
## 4 least connected regions:
## 158 160 463 959 with 1 link
## 1 most connected region:
## 545 with 47 links</code></pre>
<pre class="r"><code># Lets plot that
plot(st_geometry(msoa.spdf), border = &quot;grey60&quot;)
plot(dist_3.nb, coords, 
     add = TRUE, pch = 19, cex = 0.6)</code></pre>
<p><img src="SICSS-spatial_part2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
</div>
<div id="normalization-of-boldsymbolmathbfw" class="section level3">
<h3>Normalization of <span class="math inline">\({\boldsymbol{\mathbf{W}}}\)</span></h3>
<p>Normalizing ensures that the parameter space of the spatial multiplier is restricted to <span class="math inline">\(-1 &lt; \rho &gt; 1\)</span>, and the multiplier matrix is non-singular. Again, how to normalize a weights matrix is subject of debate <span class="citation">(<a href="#ref-LeSage.2014.0b" role="doc-biblioref">LeSage and Pace 2014</a>; <a href="#ref-Neumayer.2016.0" role="doc-biblioref">Neumayer and Plümper 2016</a>)</span>.</p>
<p>Normalizing your weights matrix is always a good idea. Otherwise, the spatial parameters might blow up – if you can estimate the model at all.</p>
<div id="row-normalization" class="section level4">
<h4>Row-normalization</h4>
<p>Row-normalization divides each non-zero weight by the sum of all weights of unit <span class="math inline">\(i\)</span>, which is the sum of the row.</p>
<p><span class="math display">\[
\frac{w_{ij}}{\sum_j^n w_{ij}}
\]</span></p>
<ul>
<li><p>Spatial lags are average values of neighbours</p></li>
<li><p>Proportions between units (distance based) get lost</p></li>
<li><p>Can induce asymmetries: <span class="math inline">\(w_{ij} \neq w_{ji}\)</span></p></li>
</ul>
<p>For instance, we can use row-normalization for the Queens neighbours created above, and create a neighbours list with spatial weights</p>
<pre class="r"><code>queens.lw &lt;- nb2listw(queens.nb,
                      style = &quot;W&quot;) # W ist row-normalization
summary(queens.lw)</code></pre>
<pre><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 983 
## Number of nonzero links: 5620 
## Percentage nonzero weights: 0.5816065 
## Average number of links: 5.717192 
## Link number distribution:
## 
##   2   3   4   5   6   7   8   9  10  11  12  13 
##   9  40 132 268 279 159  63  19   6   5   2   1 
## 9 least connected regions:
## 160 270 475 490 597 729 755 778 861 with 2 links
## 1 most connected region:
## 946 with 13 links
## 
## Weights style: W 
## Weights constants summary:
##     n     nn  S0       S1      S2
## W 983 966289 983 356.6902 4018.36</code></pre>
</div>
<div id="maximum-eigenvalues-normalization" class="section level4">
<h4>Maximum eigenvalues normalization</h4>
<p>Maximum eigenvalues normalization: Divide each non-zero weight by overall maximum eigenvalue <span class="math inline">\(\lambda_{max}\)</span>. Each element of <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> is divided by the same scalar parameter.</p>
<p><span class="math display">\[
\frac{\boldsymbol{\mathbf{W}}}{\lambda_{max}}
\]</span></p>
<ul>
<li><p>Interpretation may become more complicated</p></li>
<li><p>Keeps proportions of connectivity strengths across units (relevant esp. for distance based <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span>)</p></li>
</ul>
<p>For instance, we can use eigenvalue normalization for the inverse distance neighbours. We use <code>nb2listwdist()</code> to create weight by inverse distance and normalize in one step.</p>
<pre class="r"><code>idw.lw &lt;- nb2listwdist(dist_3.nb,
                       x = coords, # needed for idw
                       type = &quot;idw&quot;, # inverse distance weighting
                       alpha = 1, # the decay parameter for distance weighting
                       style = &quot;minmax&quot;) # for eigenvalue normalization
summary(idw.lw)</code></pre>
<pre><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 983 
## Number of nonzero links: 22086 
## Percentage nonzero weights: 2.285652 
## Average number of links: 22.46796 
## Link number distribution:
## 
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
##  4  3  7 13 11 14 14 17 26 22 26 30 33 34 46 34 59 43 38 30 25 19 22 15 21 14 
## 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 
## 23 17 17 23 28 19 26 24 29 24 27 25 22 18  8 10 12  5  3  2  1 
## 4 least connected regions:
## 158 160 463 959 with 1 link
## 1 most connected region:
## 545 with 47 links
## 
## Weights style: minmax 
## Weights constants summary:
##          n     nn       S0       S1       S2
## minmax 983 966289 463.6269 23.92505 1117.636</code></pre>
</div>
</div>
<div id="spatial-autocorrelation" class="section level3">
<h3>Spatial Autocorrelation</h3>
<p>If spatially close observations are more likely to exhibit similar values, we cannot handle observations as if they were independent.</p>
<p><span class="math display">\[ 
\mathrm{E}(\varepsilon_i\varepsilon_j)\neq \mathrm{E}(\varepsilon_i)\mathrm{E}(\varepsilon_j) = 0
\]</span></p>
<p>This violates a basic assumption of the conventional OLS model. In consequence, ignoring spatial dependence can lead to</p>
<ul>
<li><p>biased inferential statistics</p></li>
<li><p>biased point estimates (depending on the DGP)</p></li>
</ul>
<div id="detection-visualization" class="section level4">
<h4>Detection: Visualization</h4>
<p>There is one very easy and intuitive way of detecting spatial autocorrelation: Just look at the map. We do so by using <code>tmap</code> for plotting the housing values.</p>
<pre class="r"><code>mp1 &lt;- tm_shape(msoa.spdf) +
  tm_fill(col = &quot;Value&quot;, 
          #style = &quot;cont&quot;,
          style = &quot;fisher&quot;, n = 8,
          title = &quot;Median&quot;, 
          palette = viridis(n = 8, direction = -1, option = &quot;C&quot;),
          legend.hist = TRUE) +
  tm_borders(col = &quot;black&quot;, lwd = 1) +
  tm_layout(legend.frame = TRUE, legend.bg.color = TRUE,
            #legend.position = c(&quot;right&quot;, &quot;bottom&quot;),
            legend.outside = TRUE,
            main.title = &quot;Housing values 2017&quot;, 
            main.title.position = &quot;center&quot;,
            title.snap.to.legend = TRUE) 

mp1 </code></pre>
<p><img src="SICSS-spatial_part2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre><code>## [1] &quot;#F0F921&quot; &quot;#FEBC2A&quot; &quot;#F48849&quot; &quot;#DB5C68&quot; &quot;#B93289&quot; &quot;#8B0AA5&quot; &quot;#5402A3&quot;
## [8] &quot;#0D0887&quot;</code></pre>
</div>
<div id="detection-morans-i" class="section level4">
<h4>Detection: Moran’s I</h4>
<p>Global Moran’s I test statistic: <span class="math display">\[      
        \begin{equation} 
        \boldsymbol{\mathbf{I}}  = \frac{N}{S_0}  
        \frac{\sum_i\sum_j w_{ij}(y_i-\bar{y})(y_j-\bar{y})}
            {\sum_i (y_i-\bar{y})}, \text{where } S_0 = \sum_{i=1}^N\sum_{j=1}^N w_{ij}
        \end{equation}
\]</span></p>
<ul>
<li><p>Relation of the deviation from the mean value between unit <span class="math inline">\(i\)</span> and neighbours of unit <span class="math inline">\(i\)</span>. Basically, this measures correlation between neighbouring values.</p></li>
<li><p>Negative values: negative autocorrelation</p></li>
<li><p>Around zero: no autocorrelation</p></li>
<li><p>Positive values: positive autocorrelation</p></li>
</ul>
<pre class="r"><code># Global Morans I test of housing values based on contiguity weights
moran.test(msoa.spdf$Value, listw = queens.lw, alternative = &quot;two.sided&quot;)</code></pre>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  msoa.spdf$Value  
## weights: queens.lw    
## 
## Moran I statistic standard deviate = 37.238, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      0.7068094990     -0.0010183299      0.0003613048</code></pre>
<pre class="r"><code># Global Morans I test of housing values based on idw
moran.test(msoa.spdf$Value, listw = idw.lw, alternative = &quot;two.sided&quot;)</code></pre>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  msoa.spdf$Value  
## weights: idw.lw    
## 
## Moran I statistic standard deviate = 70.475, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      0.7260392810     -0.0010183299      0.0001064319</code></pre>
</div>
</div>
<div id="spatial-regression-models" class="section level3">
<h3>Spatial Regression Models</h3>
<p>There are a bunch of different techniques to model spatial dependence and spatial processes <span class="citation">(<a href="#ref-LeSage.2009.0" role="doc-biblioref">LeSage and Pace 2009</a>)</span>. Here, we will just cover a few of the most common techniques / econometric models. One advantage of the most basic spatial model (SLX) is that this method can easily be incorporated in a variety of other methodologies, such as machine learning approaches. <span class="citation"><a href="#ref-HalleckVega.2015.0" role="doc-biblioref">Halleck Vega and Elhorst</a> (<a href="#ref-HalleckVega.2015.0" role="doc-biblioref">2015</a>)</span>, LeSage.2014.0, and <span class="citation"><a href="#ref-Ruttenauer.2019c" role="doc-biblioref">Rüttenauer</a> (<a href="#ref-Ruttenauer.2019c" role="doc-biblioref">2019</a>)</span> provide article-length introductions.</p>
<p>There are three basic ways of incorporating spatial dependece.</p>
<div id="spatial-error-model-sem" class="section level5">
<h5>Spatial Error Model (SEM)</h5>
<ul>
<li>Clustering on Unobservables</li>
</ul>
<p><span class="math display">\[
        \begin{equation} 
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split} 
        \end{equation}
\]</span></p>
</div>
<div id="spatial-autoregressive-model-sar" class="section level5">
<h5>Spatial Autoregressive Model (SAR)</h5>
<ul>
<li>Interdependence</li>
</ul>
<p><span class="math display">\[
    \begin{equation} 
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
        \end{equation}  
\]</span></p>
</div>
<div id="spatially-lagged-x-model-slx" class="section level5">
<h5>Spatially lagged X Model (SLX)</h5>
<ul>
<li>Clustering on Spillovers in Covariates</li>
</ul>
<p><span class="math display">\[
        \begin{equation}
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
        \end{equation}
\]</span><br />
Moreover, there are models combining two sets of the above specifications.</p>
</div>
<div id="spatial-durbin-model-sdm" class="section level5">
<h5>Spatial Durbin Model (SDM)</h5>
<p><span class="math display">\[
        \begin{equation}
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
        \end{equation}
\]</span></p>
</div>
<div id="spatial-durbin-error-model-sdem" class="section level5">
<h5>Spatial Durbin Error Model (SDEM)</h5>
<p><span class="math display">\[
    \begin{equation}
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split}
        \end{equation}
\]</span></p>
</div>
<div id="combined-spatial-autocorrelation-model-sac" class="section level5">
<h5>Combined Spatial Autocorrelation Model (SAC)</h5>
<p><span class="math display">\[
        \begin{equation}
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split}
        \end{equation}
\]</span></p>
<p>Note that all of these models assume different data generating processes (DGP) leading to the spatial correlation or pattern we observe in the data. Although there are specifications tests, it is generally not possible to let the data decide which one is the true underlying DGP <span class="citation">(<a href="#ref-Cook.2015.563" role="doc-biblioref">Cook, Hays, and Franzese 2015</a>; <a href="#ref-Ruttenauer.2019c" role="doc-biblioref">Rüttenauer 2019</a>)</span>. However, there might be theoretical reasons to guide the model specification <span class="citation">(<a href="#ref-Cook.2015.563" role="doc-biblioref">Cook, Hays, and Franzese 2015</a>)</span>.</p>
<p>Just because SAR is probably the model most commonly used does not mean it is the best choice or the most robust alternative. In contrast, various studies <span class="citation">(<a href="#ref-HalleckVega.2015.0" role="doc-biblioref">Halleck Vega and Elhorst 2015</a>; <a href="#ref-Ruttenauer.2019c" role="doc-biblioref">Rüttenauer 2019</a>; <a href="#ref-Wimpy.2021" role="doc-biblioref">Wimpy, Whitten, and Williams 2021</a>)</span> highlight the advantages of the relative simple SLX model. Moreover, this specification can basically be incorporated in any other statistical method.</p>
</div>
</div>
<div id="spatial-regression-models-example" class="section level3">
<h3>Spatial Regression Models: Example</h3>
<p>To estimate spatial models, we can currently use <code>spdep</code> or <code>spatialreg</code>. They contain the same functions, but spatial regression models will be made defunct in <code>spdep</code> in future releases, and will only be available in <code>spatialreg</code>.</p>
<div id="sar" class="section level4">
<h4>SAR</h4>
<p>Lets estimate a spatial SAR model using the <code>lagsarlm()</code> with contiguity weights. Here we use the median housing values as depended variable. We include population density (<code>POPDEN</code>), the percentage of tree cover (<code>canopy_per</code>), and the number of pubs (<code>pubs_count</code>)</p>
<pre class="r"><code>hv_1.sar &lt;- lagsarlm(log(Value) ~ log(POPDEN) + canopy_per + pubs_count,  
                     data = msoa.spdf, 
                     listw = queens.lw,
                     Durbin = FALSE) # we could here extend to SDM
summary(hv_1.sar)</code></pre>
<pre><code>## 
## Call:lagsarlm(formula = log(Value) ~ log(POPDEN) + canopy_per + pubs_count, 
##     data = msoa.spdf, listw = queens.lw, Durbin = FALSE)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.701583 -0.126770 -0.013526  0.113585  0.885312 
## 
## Type: lag 
## Coefficients: (asymptotic standard errors) 
##                Estimate  Std. Error z value  Pr(&gt;|z|)
## (Intercept)  2.34991935  0.26979188  8.7101 &lt; 2.2e-16
## log(POPDEN) -0.00656500  0.01010056 -0.6500    0.5157
## canopy_per   0.00437247  0.00096848  4.5148 6.338e-06
## pubs_count   0.00339695  0.00066231  5.1289 2.914e-07
## 
## Rho: 0.81488, LR test value: 812.14, p-value: &lt; 2.22e-16
## Asymptotic standard error: 0.020564
##     z-value: 39.627, p-value: &lt; 2.22e-16
## Wald statistic: 1570.3, p-value: &lt; 2.22e-16
## 
## Log likelihood: 81.90148 for lag model
## ML residual variance (sigma squared): 0.041654, (sigma: 0.20409)
## Number of observations: 983 
## Number of parameters estimated: 6 
## AIC: -151.8, (AIC for lm: 658.33)
## LM test for residual autocorrelation
## test value: 43.85, p-value: 3.5444e-11</code></pre>
<p>This looks pretty much like a conventional model output, with some additional information: a highly significant <code>hv_1.sar$rho</code> of 0.81 indicates strong positive spatial autocorrelation. In substantive terms, housing prices in the focal unit positively influence housing prices in neighbouring units, which again influences housing prices among the neighbours of these neighbours, and so on.</p>
<p><strong>NOTE</strong>: interpreting the coefficients or covariates in a SAR model seldomly makes sense, because of the spillovers and feedback loops in <span class="math inline">\(\boldsymbol{\mathbf{y}}\)</span> mentioned above!</p>
</div>
<div id="sem" class="section level4">
<h4>SEM</h4>
<p>SEM models can be estimated using <code>errorsarlm()</code>.</p>
<pre class="r"><code>hv_1.sem &lt;- errorsarlm(log(Value) ~ log(POPDEN) + canopy_per + pubs_count,  
                     data = msoa.spdf, 
                     listw = queens.lw,
                     Durbin = FALSE) # we could here extend to SDM
summary(hv_1.sem)</code></pre>
<pre><code>## 
## Call:errorsarlm(formula = log(Value) ~ log(POPDEN) + canopy_per + 
##     pubs_count, data = msoa.spdf, listw = queens.lw, Durbin = FALSE)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.6517136 -0.1255899 -0.0090777  0.1069794  0.7484496 
## 
## Type: error 
## Coefficients: (asymptotic standard errors) 
##                Estimate  Std. Error  z value  Pr(&gt;|z|)
## (Intercept) 13.32527965  0.09204716 144.7658 &lt; 2.2e-16
## log(POPDEN) -0.08515645  0.01498954  -5.6811 1.339e-08
## canopy_per   0.00689488  0.00157390   4.3807 1.183e-05
## pubs_count   0.00078552  0.00078907   0.9955    0.3195
## 
## Lambda: 0.85212, LR test value: 837.93, p-value: &lt; 2.22e-16
## Asymptotic standard error: 0.018563
##     z-value: 45.903, p-value: &lt; 2.22e-16
## Wald statistic: 2107.1, p-value: &lt; 2.22e-16
## 
## Log likelihood: 94.7968 for error model
## ML residual variance (sigma squared): 0.039582, (sigma: 0.19895)
## Number of observations: 983 
## Number of parameters estimated: 6 
## AIC: -177.59, (AIC for lm: 658.33)</code></pre>
<p>In this case <code>hv_1.sem$lambda</code> gives us the spatial parameter. In a spatial error model, we can interpret the coefficients directly, as in a conventional linear model.</p>
</div>
<div id="slx" class="section level4">
<h4>SLX</h4>
<p>Above, we could have estimated SDM and SDEM models using the <code>Durbin</code> option. To estimate SLX models, we can either use <code>lmSLX()</code> directly, or we can create <span class="math inline">\(\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{X}}\)</span> manually and use that in any available model fitting function.</p>
<pre class="r"><code>hv_1.slx &lt;- lmSLX(log(Value) ~ log(POPDEN) + canopy_per + pubs_count,  
                  data = msoa.spdf, 
                  listw = queens.lw, 
                  Durbin = TRUE) # use a formula to lag only specific covariates
summary(hv_1.slx)</code></pre>
<pre><code>## 
## Call:
## lm(formula = formula(paste(&quot;y ~ &quot;, paste(colnames(x)[-1], collapse = &quot;+&quot;))), 
##     data = as.data.frame(x), weights = weights)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.79338 -0.19863 -0.04346  0.16392  1.39421 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     11.688384   0.102148 114.426  &lt; 2e-16 ***
## log.POPDEN.     -0.060335   0.023521  -2.565 0.010461 *  
## canopy_per       0.008649   0.002597   3.330 0.000899 ***
## pubs_count       0.003553   0.001233   2.882 0.004032 ** 
## lag.log.POPDEN.  0.289264   0.029571   9.782  &lt; 2e-16 ***
## lag.canopy_per   0.010337   0.003412   3.030 0.002512 ** 
## lag.pubs_count   0.015908   0.001691   9.407  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3102 on 976 degrees of freedom
## Multiple R-squared:  0.2924, Adjusted R-squared:  0.288 
## F-statistic:  67.2 on 6 and 976 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>In SLX models, we receive the direct effects of covariates as well as the effects of the spatially lagged variables. Here, we can interpret the coefficients directly. For instance, lets look at population density: 1) a high population density in the focal unit is related to lower housing prices, but 2) a high population density in the neighbouring areas in related to higher housing prices (while keeping population density in the focal unit constant). This might indicate that areas with a low population density in central regions of the city (high pop density around) have higher housing prices. We could try testing this interpretation by including the distance to the city centre as a control.</p>
<p>Another way of estimating the same model is lagging the covariates first.</p>
<pre class="r"><code># Loop through vars and create lagged variables
msoa.spdf$log_POPDEN &lt;- log(msoa.spdf$POPDEN)
vars &lt;- c(&quot;Value&quot;, &quot;log_POPDEN&quot;, &quot;canopy_per&quot;, &quot;pubs_count&quot;)
for(v in vars){
  msoa.spdf[, paste0(&quot;w.&quot;, v)] &lt;- lag.listw(queens.lw,
                                            var = st_drop_geometry(msoa.spdf)[, v])
}

# Alternatively:
w_vars &lt;- create_WX(st_drop_geometry(msoa.spdf[, vars]),
                    listw = queens.lw,
                    prefix=&quot;w&quot;)

head(w_vars)</code></pre>
<pre><code>##       w.Value w.log_POPDEN w.canopy_per w.pubs_count
## [1,] 843550.0     4.662014     9.201539    37.000000
## [2,] 353666.7     3.300901    19.324093     1.333333
## [3,] 329000.0     4.009795    15.861733     1.571429
## [4,] 337000.0     3.630360    25.492108     1.400000
## [5,] 316650.0     3.993660    17.011171     1.000000
## [6,] 317375.0     3.876070    23.598908     1.000000</code></pre>
<p>And subsequently we use those new variable in a linear model.</p>
<pre class="r"><code>hv_1.lm &lt;- lm (log(Value) ~ log(POPDEN) + canopy_per + pubs_count +
                 w.log_POPDEN + w.canopy_per + w.pubs_count,
               data = msoa.spdf)
summary(hv_1.lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(Value) ~ log(POPDEN) + canopy_per + pubs_count + 
##     w.log_POPDEN + w.canopy_per + w.pubs_count, data = msoa.spdf)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.79338 -0.19863 -0.04346  0.16392  1.39421 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.688384   0.102148 114.426  &lt; 2e-16 ***
## log(POPDEN)  -0.060335   0.023521  -2.565 0.010461 *  
## canopy_per    0.008649   0.002597   3.330 0.000899 ***
## pubs_count    0.003553   0.001233   2.882 0.004032 ** 
## w.log_POPDEN  0.289264   0.029571   9.782  &lt; 2e-16 ***
## w.canopy_per  0.010337   0.003412   3.030 0.002512 ** 
## w.pubs_count  0.015908   0.001691   9.407  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3102 on 976 degrees of freedom
## Multiple R-squared:  0.2924, Adjusted R-squared:  0.288 
## F-statistic:  67.2 on 6 and 976 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Looks pretty similar to <code>lmSLX()</code> results, and it should! A big advantage of the SLX specification is that we can use the lagged variables in basically all methods which take variables as inputs, such as non-linear models, matching algorithms, and machine learning tools.</p>
<p>Moreover, using the lagged variables gives a high degree of freedom. For instance, we could (not saying that it necessarily makes sense):</p>
<ul>
<li><p>Use different weights matrices for different variables</p></li>
<li><p>Include higher order neighbours using <code>nblag()</code> on the neigbours list (with increasing number of orders we go towards a more global model, but we estimate a coefficient for each spillover, instead of estiamting just one)</p></li>
<li><p>Use machine learning techniques to determine the best fitting weights specification</p></li>
</ul>
</div>
</div>
<div id="impacts" class="section level3">
<h3>Impacts</h3>
<div id="coefficient-estimates-neq-marginal-effects" class="section level4">
<h4>Coefficient estimates <span class="math inline">\(\neq\)</span> `marginal’ effects</h4>
<p><strong>Attention</strong>: Do not interpret coefficients in SAR, SAC, and SDM!! Using the reduced form</p>
<p><span class="math display">\[  
    \begin{equation}
    \begin{split}
        {\boldsymbol{\mathbf{y}}} &amp; =\alpha{\boldsymbol{\mathbf{\iota}}}+\rho {\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{\varepsilon}}} \\
        {\boldsymbol{\mathbf{y}}} &amp; =({\boldsymbol{\mathbf{I}}}-\rho{\boldsymbol{\mathbf{W}}})^{-1}(\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{\varepsilon}}}),
    \end{split}
    \end{equation}
\]</span></p>
<p>we can calculate the first derivative:</p>
<p><span class="math display">\[  
    \begin{equation}
    \begin{split}
        \frac{\partial \boldsymbol{\mathbf{y}}}{\partial \boldsymbol{\mathbf{x}}_k} &amp; = ({\boldsymbol{\mathbf{I}}}-\rho{\boldsymbol{\mathbf{W}}})^{-1}\beta_k \\
        &amp; =({\boldsymbol{\mathbf{I}}} + \rho{\boldsymbol{\mathbf{W}}} + \rho^2{\boldsymbol{\mathbf{W}}}^2 + \rho^3{\boldsymbol{\mathbf{W}}}^3 + ...)\beta_k, 
    \end{split}
    \end{equation}  
\]</span><br />
where <span class="math inline">\(\rho{\boldsymbol{\mathbf{W}}}\beta_k\)</span> equals the effect stemming from direct neighbours, <span class="math inline">\(\rho^2{\boldsymbol{\mathbf{W}}}^2\beta_k\)</span> the effect stemming from second order neighbours (neighbours of neighbours),… This also includes feedback loops if unit <span class="math inline">\(i\)</span> is also a second order neighbour of itself.</p>
</div>
<div id="impacts-1" class="section level4">
<h4>Impacts</h4>
<p>Note that the derivatives consist of a matrix, returning individual effects for each unit on each other unit, differentialet in <em>direct, indirect, and total impacts</em>. However, these individual effects mainly vary because of variation in <span class="math inline">\({\boldsymbol{\mathbf{W}}}\)</span>. Usually, one should use summary measures to report effects in spatial models <span class="citation">(<a href="#ref-LeSage.2009.0" role="doc-biblioref">LeSage and Pace 2009</a>)</span>. <span class="citation"><a href="#ref-HalleckVega.2015.0" role="doc-biblioref">Halleck Vega and Elhorst</a> (<a href="#ref-HalleckVega.2015.0" role="doc-biblioref">2015</a>)</span> provide a nice summary of the impacts for each model:</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Model</th>
<th align="center">Direct Impacts</th>
<th align="center">Indirect Impacts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">OLS/SEM</td>
<td align="center"><span class="math inline">\(\beta_k\)</span></td>
<td align="center">–</td>
</tr>
<tr class="even">
<td align="center">SAR/SAC</td>
<td align="center">Diagonal elements of <span class="math inline">\(({\boldsymbol{\mathbf{I}}}-\rho{\boldsymbol{\mathbf{W}}})^{-1}\beta_k\)</span></td>
<td align="center">Off-diagonal elements of <span class="math inline">\(({\boldsymbol{\mathbf{I}}}-\rho{\boldsymbol{\mathbf{W}}})^{-1}\beta_k\)</span></td>
</tr>
<tr class="odd">
<td align="center">SLX/SDEM</td>
<td align="center"><span class="math inline">\(\beta_k\)</span></td>
<td align="center"><span class="math inline">\(\theta_k\)</span></td>
</tr>
<tr class="even">
<td align="center">SDM</td>
<td align="center">Diagonal elements of <span class="math inline">\(({\boldsymbol{\mathbf{I}}}-\rho{\boldsymbol{\mathbf{W}}})^{-1}\left[\beta_k+{\boldsymbol{\mathbf{W}}}\theta_k\right]\)</span></td>
<td align="center">Off-diagonal elements of <span class="math inline">\(({\boldsymbol{\mathbf{I}}}-\rho{\boldsymbol{\mathbf{W}}})^{-1}\)</span></td>
</tr>
</tbody>
</table>
<p>The different indirect effects / spatial effects mean conceptionally different things:</p>
<ul>
<li><p>Global spillover effects: SAR, SAC, SDM</p></li>
<li><p>Local spillover effects: SLX, SDEM</p></li>
</ul>
<p>We can calculate these impacts using <code>impacts()</code> with simulated distributions, e.g. for the SAR model:</p>
<pre class="r"><code>hv_1.sar.imp &lt;- impacts(hv_1.sar, listw = queens.lw, R = 300)
summary(hv_1.sar.imp, zstats = TRUE, short = TRUE)</code></pre>
<pre><code>## Impact measures (lag, exact):
##                   Direct    Indirect       Total
## log(POPDEN) -0.008216925 -0.02724569 -0.03546261
## canopy_per   0.005472698  0.01814638  0.02361907
## pubs_count   0.004251709  0.01409782  0.01834953
## ========================================================
## Simulation results ( variance matrix):
## ========================================================
## Simulated standard errors
##                   Direct    Indirect       Total
## log(POPDEN) 0.0133116737 0.046286771 0.059516113
## canopy_per  0.0013067735 0.004500021 0.005675619
## pubs_count  0.0008021718 0.003331039 0.004029913
## 
## Simulated z-values:
##                 Direct   Indirect      Total
## log(POPDEN) -0.5104614 -0.4995427 -0.5026759
## canopy_per   4.1932706  4.0865128  4.2055413
## pubs_count   5.3402741  4.3464561  4.6556926
## 
## Simulated p-values:
##             Direct     Indirect   Total     
## log(POPDEN) 0.60973    0.6174     0.61519   
## canopy_per  2.7496e-05 4.3791e-05 2.6046e-05
## pubs_count  9.2806e-08 1.3835e-05 3.2289e-06</code></pre>
<pre class="r"><code># Alternative with traces (better for large W)
W &lt;- as(queens.lw, &quot;CsparseMatrix&quot;)
trMatc &lt;- trW(W, type=&quot;mult&quot;)
hv_1.sar.imp2 &lt;- impacts(hv_1.sar, tr = trMatc, R = 300, Q = 10)
summary(hv_1.sar.imp2, zstats = TRUE, short = TRUE)</code></pre>
<pre><code>## Impact measures (lag, trace):
##                   Direct    Indirect       Total
## log(POPDEN) -0.008216080 -0.02717024 -0.03538632
## canopy_per   0.005472135  0.01809612  0.02356826
## pubs_count   0.004251272  0.01405878  0.01831005
## ========================================================
## Simulation results ( variance matrix):
## ========================================================
## Simulated standard errors
##                   Direct    Indirect       Total
## log(POPDEN) 0.0132921855 0.046014632 0.059215583
## canopy_per  0.0011358850 0.004281024 0.005295750
## pubs_count  0.0008360857 0.003164799 0.003892459
## 
## Simulated z-values:
##                 Direct   Indirect      Total
## log(POPDEN) -0.6186894 -0.6033781 -0.6077446
## canopy_per   4.8220746  4.3060442  4.5152434
## pubs_count   5.1119758  4.5422384  4.7911422
## 
## Simulated p-values:
##             Direct     Indirect  Total     
## log(POPDEN) 0.53612    0.54626   0.54336   
## canopy_per  1.4207e-06 1.662e-05 6.3244e-06
## pubs_count  3.1881e-07 5.566e-06 1.6583e-06</code></pre>
<p>The indirect effects here refer to global spillover effects. This means a change of <span class="math inline">\(x\)</span> in the focal units flows through the entire system of neighbours (direct nieightbours, neighbours of neighbours, …) influencing <span class="math inline">\(y\)</span>. One can think of this as diffusion in time or a change in long-term equilibrium.</p>
<p>For SLX models, nothing is gained from computing the impacts</p>
<pre class="r"><code>print(impacts(hv_1.slx, listw = queens.lw))</code></pre>
<pre><code>## Impact measures (SlX, estimable):
##                   Direct   Indirect      Total
## log(POPDEN) -0.060334591 0.28926384 0.22892925
## canopy_per   0.008649132 0.01033740 0.01898653
## pubs_count   0.003552843 0.01590812 0.01946096</code></pre>
</div>
</div>
<div id="references" class="section level3 unnumbered">
<h3 class="unnumbered">References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bivand.2018.748" class="csl-entry">
Bivand, Roger, Edzer Pebesma, and Virgilio Gómez-Rubio. 2008. <span>“<span>Creating Neighbours</span>.”</span> <a href="https://r-spatial.github.io/spdep/articles/nb.html">https://r-spatial.github.io/spdep/articles/nb.html</a>.
</div>
<div id="ref-Cook.2015.563" class="csl-entry">
Cook, Scott J., Jude C. Hays, and Robert J. Franzese. 2015. <span>“<span class="nocase">Model Specification and Spatial Interdependence: Paper prepared for the 2015 Summer Methods Meeting</span>.”</span> <a href="http://www.sas.rochester.edu/psc/polmeth/papers/Cook_Hays_Franzese.pdf">http://www.sas.rochester.edu/psc/polmeth/papers/Cook_Hays_Franzese.pdf</a>.
</div>
<div id="ref-HalleckVega.2015.0" class="csl-entry">
Halleck Vega, Solmaria, and J. Paul Elhorst. 2015. <span>“<span>The SLX Model</span>.”</span> <em><span>Journal of Regional Science</span></em> 55 (3): 339–63. <a href="https://doi.org/10.1111/jors.12188">https://doi.org/10.1111/jors.12188</a>.
</div>
<div id="ref-LeSage.2009.0" class="csl-entry">
LeSage, James P., and R. Kelley Pace. 2009. <em><span class="nocase">Introduction to Spatial Econometrics</span></em>. <span class="nocase">Statistics, Textbooks and Monographs</span>. Boca Raton: <span>CRC Press</span>.
</div>
<div id="ref-LeSage.2014.0b" class="csl-entry">
———. 2014. <span>“<span class="nocase">The Biggest Myth in Spatial Econometrics</span>.”</span> <em><span>Econometrics</span></em> 2 (4): 217–49. <a href="https://doi.org/10.3390/econometrics2040217">https://doi.org/10.3390/econometrics2040217</a>.
</div>
<div id="ref-Neumayer.2016.0" class="csl-entry">
Neumayer, Eric, and Thomas Plümper. 2016. <span>“<span>W</span>.”</span> <em><span>Political Science Research and Methods</span></em> 4 (01): 175–93. <a href="https://doi.org/10.1017/psrm.2014.40">https://doi.org/10.1017/psrm.2014.40</a>.
</div>
<div id="ref-Ruttenauer.2019c" class="csl-entry">
Rüttenauer, Tobias. 2019. <span>“<span class="nocase">Spatial Regression Models: A Systematic Comparison of Different Model Specifications Using Monte Carlo Experiments</span>.”</span> <em><span>Sociological Methods <span>&amp;</span> Research</span></em> OnlineFirst. <a href="https://doi.org/10.1177/0049124119882467">https://doi.org/10.1177/0049124119882467</a>.
</div>
<div id="ref-Tobler.1970.0" class="csl-entry">
Tobler, Waldo R. 1970. <span>“<span class="nocase">A Computer Movie Simulating Urban Growth in the Detroit Region</span>.”</span> <em><span>Economic Geography</span></em> 46: 234–40. <a href="https://doi.org/10.2307/143141">https://doi.org/10.2307/143141</a>.
</div>
<div id="ref-Wimpy.2021" class="csl-entry">
Wimpy, Cameron, Guy D. Whitten, and Laron K. Williams. 2021. <span>“<span class="nocase">X Marks the Spot: Unlocking the Treasure of Spatial-X Models</span>.”</span> <em><span>The Journal of Politics</span></em> 83 (2): 722–39. <a href="https://doi.org/10.1086/710089">https://doi.org/10.1086/710089</a>.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
